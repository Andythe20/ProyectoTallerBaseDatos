<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <title>Usuarios</title>
</head>
<body class="container">

<h1>Usuarios</h1>

<!-- Botón para abrir el modal -->
<button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#agregarUsuarioModal">
    Agregar nuevo usuario
</button>

<h2>Lista de Usuarios</h2>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Edad</th>
        <th>Acciones</th> <!-- Nueva columna para botones -->
    </tr>
    </thead>
    <tbody>
    <tr th:each="usuario, iterStat : ${clientes}">
        <!-- Nombre completo -->
        <td th:text="${usuario.pnombre + ' ' + (usuario.snombre != null ? usuario.snombre + ' ' : '') + usuario.appaterno + ' ' + (usuario.apmaterno != null ? usuario.apmaterno : '')}"></td>
        <!-- Correo -->
        <td th:text="${usuario.correo}"></td>
        <!-- Edad (aquí solo ponemos fechaNacimiento porque edad no está calculada) -->
        <td th:text="${usuario.fechaNacimiento}"></td>
        <td>
            <!-- Botón Editar -->
            <a th:href="@{'/editar/' + ${usuario.numrun}}" class="btn btn-warning btn-sm me-2">Editar</a>
            <!-- Botón Borrar -->
            <form th:action="@{'/borrar/' + ${usuario.numrun}}" method="post" style="display:inline">
                <button type="submit" class="btn btn-danger btn-sm"
                        onclick="return confirm('¿Seguro que quieres borrar este usuario?');">
                    Borrar
                </button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<!-- Modal COMPLETO con todos los campos -->
<div class="modal fade" id="agregarUsuarioModal" tabindex="-1" aria-labelledby="agregarUsuarioModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form th:action="@{/}" th:object="${cliente}" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="agregarUsuarioModalLabel">Agregar nuevo cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Columna 1: Datos personales -->
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2">Datos Personales</h6>

                            <!-- RUN y DV -->
                            <div class="row">
                                <div class="col-8">
                                    <div class="mb-3">
                                        <label for="numrun" class="form-label">RUN *</label>
                                        <input type="text" th:field="*{numrun}" class="form-control" id="numrun" required />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label for="dvrun" class="form-label">DV *</label>
                                        <input type="text" th:field="*{dvrun}" class="form-control" id="dvrun" maxlength="1" required />
                                    </div>
                                </div>
                            </div>

                            <!-- Nombres -->
                            <div class="mb-3">
                                <label for="pnombre" class="form-label">Primer Nombre *</label>
                                <input type="text" th:field="*{pnombre}" class="form-control" id="pnombre" required />
                            </div>

                            <div class="mb-3">
                                <label for="snombre" class="form-label">Segundo Nombre</label>
                                <input type="text" th:field="*{snombre}" class="form-control" id="snombre" />
                            </div>

                            <!-- Apellidos -->
                            <div class="mb-3">
                                <label for="appaterno" class="form-label">Apellido Paterno *</label>
                                <input type="text" th:field="*{appaterno}" class="form-control" id="appaterno" required />
                            </div>

                            <div class="mb-3">
                                <label for="apmaterno" class="form-label">Apellido Materno</label>
                                <input type="text" th:field="*{apmaterno}" class="form-control" id="apmaterno" />
                            </div>

                            <!-- Fechas -->
                            <div class="mb-3">
                                <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento *</label>
                                <input type="date" th:field="*{fechaNacimiento}" class="form-control" id="fechaNacimiento" required />
                            </div>

                            <div class="mb-3">
                                <label for="fechaInscripcion" class="form-label">Fecha de Inscripción *</label>
                                <input type="date" th:field="*{fechaInscripcion}" class="form-control" id="fechaInscripcion" required />
                            </div>
                        </div>

                        <!-- Columna 2: Contacto y ubicación -->
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2">Contacto y Ubicación</h6>

                            <!-- Contacto -->
                            <div class="mb-3">
                                <label for="correo" class="form-label">Correo</label>
                                <input type="email" th:field="*{correo}" class="form-control" id="correo" />
                            </div>

                            <div class="mb-3">
                                <label for="fonoContacto" class="form-label">Teléfono de Contacto</label>
                                <input type="number" th:field="*{fonoContacto}" class="form-control" id="fonoContacto" />
                            </div>

                            <div class="mb-3">
                                <label for="direccion" class="form-label">Dirección *</label>
                                <input type="text" th:field="*{direccion}" class="form-control" id="direccion" required />
                            </div>

                            <!-- Códigos de ubicación -->
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label for="codRegion" class="form-label">Región *</label>
                                        <input type="number" th:field="*{codRegion}" class="form-control" id="codRegion" required />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label for="codProvincia" class="form-label">Provincia *</label>
                                        <input type="number" th:field="*{codProvincia}" class="form-control" id="codProvincia" required />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label for="codComuna" class="form-label">Comuna *</label>
                                        <input type="number" th:field="*{codComuna}" class="form-control" id="codComuna" required />
                                    </div>
                                </div>
                            </div>

                            <!-- Códigos adicionales -->
                            <div class="mb-3">
                                <label for="codProfOfic" class="form-label">Código Profesión/Oficio *</label>
                                <input type="number" th:field="*{codProfOfic}" class="form-control" id="codProfOfic" required />
                            </div>

                            <div class="mb-3">
                                <label for="codTipoCliente" class="form-label">Tipo de Cliente *</label>
                                <input type="number" th:field="*{codTipoCliente}" class="form-control" id="codTipoCliente" required />
                            </div>
                        </div>
                    </div>
                    <small class="text-muted">* Campos obligatorios</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cliente</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script>
    // Bootstrap 5 form validation
    (() => {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>
</body>
</html>
